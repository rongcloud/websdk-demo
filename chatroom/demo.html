<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>chatroom component</title>
</head>
<body>


<style>
.rc-chatroom *{
	margin:0;
	padding:0;
	list-style:none;
}	
.rc-chatroom {
	width:400px;
	border:1px solid #ccc;
	border-radius:3px;
}
.rc-message-list-wrapper{
	width:100%;
	height:600px;
	overflow:auto;	
	position:relative;
}
.rc-message-list{
	width:100%;
	position:absolute;
	bottom:0;
	left:0;
}
.rc-message{
	clear:both;
	font-size:14px;
	line-height:1.5;
	border-bottom:1px solid #f5f5f5;
	padding-bottom:10px;
	margin:5px;
	vertical-align:top;
}
.rc-message-portrait{
	display:inline-block;
	float:left;
	margin:5px;
}
.rc-message-portrait img{
	width:40px;
	height:40px;
	border:1px solid #ccc;
	border-radius:50%;
}
.rc-message-time,
.rc-message-name{
	display:inline-block;
	margin-left:0.5em;
	margin-top:0.5em;
}
.rc-message-content{
	margin-left:4.2em;
}

.rc-chatroom-user{
	height:30px;
	padding:5px;
	padding-bottom:10px;
	position:relative;
}
.rc-emoji-panel{
	display:none;
	width:19em;
	border:1px solid #ccc;
	padding:10px;
	background:#f5f5f5;
	position:absolute;
	left:3px;
	bottom:40px;
}
.rc-chatroom-emoji{
	line-height:30px;
	font-size:24px;
	cursor:pointer;
}
.rc-chatroom-input{
	width:72%;
	height:24px;
	padding:2px;
	border:1px solid #ccc;
	background:#f5f5f5;
}
.rc-chatroom-button{
	background:#333;
	color:#fff;
	border-radius:3px;
	padding:6px 20px;
}
</style>

<div id="show">
	<div class="rc-chatroom">
		<div class="rc-message-list-wrapper">
			<div class="rc-message-list" id="rc-message-list"></div>
		</div>

		<div class="rc-chatroom-user">
			<span class="rc-chatroom-emoji" id="rc-chatroom-emoji">ğŸ˜„</span>
			<div class="rc-emoji-panel" id="rc-emoji-panel"></div>
			<input class="rc-chatroom-input" id="rc-chatroom-input" type="text" placeholder="å‘è¡¨ä½ çš„ç²¾å½©è¯„è®º">
			<input class="rc-chatroom-button" id="rc-chatroom-button" type="submit" value="å‘é€">
		</div>
	</div>
</div>
<script src="//cdn.ronghub.com/RongEmoji-2.2.6.js"></script> 
<script src="chatroom.sdk.js"></script>	
<script>
//mock
function getRandomText(){
	var messages = "çµç¶è¡Œï¼Œç™½å±…æ˜“ï¼Œæµ”é˜³æ±Ÿå¤´å¤œé€å®¢ï¼Œæ«å¶è»èŠ±ç§‹ç‘Ÿç‘Ÿã€‚ä¸»äººä¸‹é©¬å®¢åœ¨èˆ¹ï¼Œä¸¾é…’æ¬²é¥®æ— ç®¡å¼¦ã€‚é†‰ä¸æˆæ¬¢æƒ¨å°†åˆ«ï¼Œåˆ«æ—¶èŒ«èŒ«æ±Ÿæµ¸æœˆã€‚å¿½é—»æ°´ä¸Šçµç¶å£°ï¼Œä¸»äººå¿˜å½’å®¢ä¸å‘ã€‚å¯»å£°æš—é—®å¼¹è€…è°ï¼Ÿçµç¶å£°åœæ¬²è¯­è¿Ÿã€‚ç§»èˆ¹ç›¸è¿‘é‚€ç›¸è§ï¼Œæ·»é…’å›ç¯é‡å¼€å®´ã€‚åƒå‘¼ä¸‡å”¤å§‹å‡ºæ¥ï¼ŒçŠ¹æŠ±çµç¶åŠé®é¢ã€‚è½¬è½´æ‹¨å¼¦ä¸‰ä¸¤å£°ï¼Œæœªæˆæ›²è°ƒå…ˆæœ‰æƒ…ã€‚å¼¦å¼¦æ©æŠ‘å£°å£°æ€ï¼Œä¼¼è¯‰å¹³ç”Ÿä¸å¾—å¿—ã€‚ä½çœ‰ä¿¡æ‰‹ç»­ç»­å¼¹ï¼Œè¯´å°½å¿ƒä¸­æ— é™äº‹ã€‚è½»æ‹¢æ…¢æ»æŠ¹å¤æŒ‘ï¼Œåˆä¸ºéœ“è£³åå…­å¹ºã€‚å¤§å¼¦å˜ˆå˜ˆå¦‚æ€¥é›¨ï¼Œå°å¼¦åˆ‡åˆ‡å¦‚ç§è¯­ã€‚å˜ˆå˜ˆåˆ‡åˆ‡é”™æ‚å¼¹ï¼Œå¤§ç å°ç è½ç‰ç›˜ã€‚é—´å…³èºè¯­èŠ±åº•æ»‘ï¼Œå¹½å’½æ³‰æµå†°ä¸‹éš¾ã€‚å†°æ³‰å†·æ¶©å¼¦å‡ç»ï¼Œå‡ç»ä¸é€šå£°æ¸æ­‡ã€‚åˆ«æœ‰å¹½æ„æš—æ¨ç”Ÿï¼Œæ­¤æ—¶æ— å£°èƒœæœ‰å£°ã€‚é“¶ç“¶ä¹ç ´æ°´æµ†è¿¸ï¼Œé“éª‘çªå‡ºåˆ€æªé¸£ã€‚æ›²ç»ˆæ”¶æ‹¨å½“å¿ƒç”»ï¼Œå››å¼¦ä¸€å£°å¦‚è£‚å¸›ã€‚ä¸œèˆ¹è¥¿èˆ«æ‚„æ— è¨€ï¼ŒæƒŸè§æ±Ÿå¿ƒç§‹æœˆç™½ã€‚æ²‰åŸæ”¾æ‹¨æ’å¼¦ä¸­ï¼Œæ•´é¡¿è¡£è£³èµ·æ•›å®¹ã€‚è‡ªè¨€æœ¬æ˜¯äº¬åŸå¥³ï¼Œå®¶åœ¨è™¾èŸ†é™µä¸‹ä½ã€‚åä¸‰å­¦å¾—çµç¶æˆï¼Œåå±æ•™åŠç¬¬ä¸€éƒ¨ã€‚æ›²ç½¢æ›¾æ•™å–„æ‰æœï¼Œå¦†æˆæ¯è¢«ç§‹å¨˜å¦’ã€‚æ­¦é™µå¹´å°‘äº‰ç¼ å¤´ï¼Œä¸€æ›²çº¢ç»¡ä¸çŸ¥æ•°ã€‚é’¿å¤´é“¶ç¯¦å‡»èŠ‚ç¢ï¼Œè¡€è‰²ç½—è£™ç¿»é…’æ±¡ã€‚ä»Šå¹´æ¬¢ç¬‘å¤æ˜å¹´ï¼Œç§‹æœˆæ˜¥é£ç­‰é—²åº¦ã€‚å¼Ÿèµ°ä»å†›é˜¿å§¨æ­»ï¼Œæš®å»æœæ¥é¢œè‰²æ•…ã€‚é—¨å‰å†·è½è½¦é©¬ç¨€ï¼Œè€å¤§å«ä½œå•†äººå¦‡ã€‚å•†äººé‡åˆ©è½»åˆ«ç¦»ï¼Œå‰æœˆæµ®æ¢ä¹°èŒ¶å»ã€‚å»æ¥æ±Ÿå£æ±‚ç©ºèˆ¹ï¼Œç»•èˆ¹æœˆæ˜æ±Ÿæ°´å¯’ã€‚å¤œæ·±å¿½æ¢¦å°‘å¹´äº‹ï¼Œæ¢¦å•¼çº¢å¦†æ³ªé˜‘å¹²ã€‚æˆ‘é—»çµç¶å·²å¹æ¯ï¼Œåˆé—»æ­¤è¯­é‡å”§å”§ã€‚åŒæ˜¯å¤©æ¶¯æ²¦è½äººï¼Œç›¸é€¢ä½•å¿…æ›¾ç›¸è¯†ã€‚æˆ‘ä»å»å²è¾å¸äº¬ï¼Œè°ªå±…å§ç—…æµ”é˜³åŸã€‚æµ”é˜³åœ°åƒ»æ— éŸ³ä¹ï¼Œç»ˆå²ä¸é—»ä¸ç«¹å£°ã€‚ä½è¿‘æ¹“åŸåœ°ä½æ¹¿ï¼Œé»„èŠ¦è‹¦ç«¹ç»•å®…ç”Ÿã€‚å…¶é—´æ—¦æš®é—»ä½•ç‰©ï¼Ÿæœé¹ƒå•¼è¡€çŒ¿å“€é¸£ã€‚æ˜¥æ±ŸèŠ±æœç§‹æœˆå¤œï¼Œå¾€å¾€å–é…’è¿˜ç‹¬å€¾ã€‚å²‚æ— å±±æ­Œä¸æ‘ç¬›ï¼Ÿå‘•å“‘å˜²å“³éš¾ä¸ºå¬ã€‚ä»Šå¤œé—»å›çµç¶è¯­ï¼Œå¦‚å¬ä»™ä¹è€³æš‚æ˜ã€‚è«è¾æ›´åå¼¹ä¸€æ›²ï¼Œä¸ºå›ç¿»ä½œçµç¶è¡Œã€‚æ„Ÿæˆ‘æ­¤è¨€è‰¯ä¹…ç«‹ï¼Œå´åä¿ƒå¼¦å¼¦è½¬æ€¥ã€‚å‡„å‡„ä¸ä¼¼å‘å‰å£°ï¼Œæ»¡åº§é‡é—»çš†æ©æ³£ã€‚åº§ä¸­æ³£ä¸‹è°æœ€å¤šï¼Ÿæ±Ÿå·å¸é©¬é’è¡«æ¹¿";

	//å°†å­—ç¬¦ä¸²æ‹†åˆ†æˆæ•°ç»„
	// messages = messages.split("ã€‚");
	messages = messages.split(/ï¼Œ|ã€‚|ï¼Ÿ/);

	var len = messages.length;
	var index = Math.ceil(Math.random()*1000000)%len;

	// console.log(messages[index]);
	return messages[index];
}	

function getUserInfo(){
	var id = Math.ceil(Math.random()*1000)%99;
	var name = "ç”¨æˆ·" + id;
	var url = "http://www.oneplusbbs.com/uc_server/images/noavatar_small.gif?" + id;
	return {
		portrait : url,
		name : name,
		id : "u-" + id
	};
}
</script>
<script>
(function(){
	//emojiè¡¨æƒ…
	var RongIMEmoji = RongIMLib.RongIMEmoji;
	RongIMEmoji.init();

	var panel = document.getElementById("rc-emoji-panel");
	var panelBtn = document.getElementById("rc-chatroom-emoji");
	var input = document.getElementById("rc-chatroom-input");
	var btn = document.getElementById("rc-chatroom-button");

	var emojis = RongIMEmoji.list;
    for (var i = 0; i < 24; i++) {
        var value = RongIMEmoji.list[i];
        panel.appendChild(value.node);
    }

	panelBtn.onclick = function(){
		if(panel.style.display == "block"){
			panel.style.display = "none";
		}else{
    		panel.style.display = "block";
    	}
    };

    //è¡¨æƒ…é€‰æ‹©
    panel.onclick = function(event){
        var e = event || window.event;
        var target = e.target || e.srcElement;
        if (document.all && !document.addEventListener === false) {
            console.log(target);
        }
        input.value += RongIMEmoji.symbolToEmoji(target.getAttribute("name"));
    }

    //å‘é€æ¶ˆæ¯
	btn.onclick = function(){
		var content = input.value;
			newMessage.content.content = content;

		panel.style.display = "none";
		input.value = "";
		sendMessage(newMessage,function(message){
			updateMessage(message);
		});
	}

	//æ¥æ”¶æ¶ˆæ¯å¹¶æ›´æ–°ui
	var newMessage = {
		"content": {
			"messageName": "TextMessage",
			"user": getUserInfo()
		},
		"conversationType": 1,
		"objectName": "RC:TxtMsg",
		"senderUserId": "user10",
		"sentTime": 1522401683566,
		"targetId": "user10",
		"messageType": "TextMessage",
		"messageUId": "B2EO-R2GR-MUA6-D3EE"
	};

	var times = 1;
	var add = setInterval(function(){
		if(times >= 20){
			clearInterval(add);
		}
		
		newMessage.content.content = getRandomText();
		times += 1;

		updateMessage(newMessage);
	},1000);

	function updateMessage(message){
		var t = document.getElementById("rc-message-list");
		message.content.content = RongIMEmoji.symbolToEmoji(message.content.content);
		var html = renderUI(message);
			t.innerHTML += html;
	}
})();
</script>
</body>
</html>